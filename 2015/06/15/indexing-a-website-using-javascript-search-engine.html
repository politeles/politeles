<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Indexing a website using javascript search engine</h1><p class="page-description">Post showing how to index a website using javascript tipuesearch.</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2015-06-15T00:00:00-05:00" itemprop="datePublished">
        Jun 15, 2015
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      2 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/categories/#javascript python html">javascript python html</a>
        
      
      </p>
    

    </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul id="toc" class="section-nav">
</ul><p>Hi, today I’m going to talk about an implementation on Javascript, called <a href="http://www.tipue.com/search/">tipue search</a>.
There are 2 possibilities, one is to perform the search online, that is, to lookup the files and do the search while querying. This is reported as not being as efficient as do an offline index.</p>

<p>So I build an index, based on json, using a python script.</p>

<p>Basically the json I wanted to create looks like this:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">var</span><span class="w"> </span><span class="err">tipuesearch</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="p">{</span><span class="nl">"pages"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
</span><span class="p">{</span><span class="nl">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Welcome to JIVE - Guidelines | "</span><span class="p">,</span><span class="w"> </span><span class="nl">"text"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Welcome to the  Jive Collaboration platform Please read this document, which contains"</span><span class="p">,</span><span class="nl">"tags"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Welcome to JIVE - Guidelines | "</span><span class="p">,</span><span class="nl">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://10.0.82.13/DOC-1001.html"</span><span class="p">},</span><span class="w">
</span><span class="p">{</span><span class="nl">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Datacenter FAQ - NGA ISO Hosting | "</span><span class="p">,</span><span class="w"> </span><span class="nl">"text"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Where are the datacenters located? Do you subcontract activities? We have several datacenters around"</span><span class="p">,</span><span class="nl">"tags"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Datacenter FAQ - NGA ISO Hosting | "</span><span class="p">,</span><span class="nl">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://10.0.82.13/DOC-1002.html"</span><span class="p">},</span><span class="w">
</span><span class="p">{</span><span class="nl">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Customer Information template | "</span><span class="p">,</span><span class="w"> </span><span class="nl">"text"</span><span class="p">:</span><span class="w"> </span><span class="s2">"This document will need to become the template that is used to create the information of the custome"</span><span class="p">,</span><span class="nl">"tags"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Customer Information template | "</span><span class="p">,</span><span class="nl">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://10.0.82.13/DOC-1003.html"</span><span class="p">},</span><span class="w">
</span><span class="p">{</span><span class="nl">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ISO Customer List | "</span><span class="p">,</span><span class="w"> </span><span class="nl">"text"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Please add customers as content is created. Please ensure you add the name alphabetically. Insert fo"</span><span class="p">,</span><span class="nl">"tags"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ISO Customer List | "</span><span class="p">,</span><span class="nl">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://10.0.82.13/DOC-1004.html"</span><span class="p">},</span><span class="w">
</span><span class="p">{</span><span class="nl">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Accenture Phillipines/Singapore - APH - Hosted | "</span><span class="p">,</span><span class="w"> </span><span class="nl">"text"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CustomerAccenture Philippines/Singaporealso known asAPHISO Project CodeAPHContract Start date01 June"</span><span class="p">,</span><span class="nl">"tags"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Accenture Phillipines/Singapore - APH - Hosted | "</span><span class="p">,</span><span class="nl">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://10.0.82.13/DOC-1006.html"</span><span class="p">},</span><span class="w">
</span><span class="p">{</span><span class="nl">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"KB: SAP logon screen hangs - Oracle | "</span><span class="p">,</span><span class="w"> </span><span class="nl">"text"</span><span class="p">:</span><span class="w"> </span><span class="s2">"KeywordsORA 257 00257 ORA-00257 Archivelog system hangs logon login screenSymptomSAP logon screen ap"</span><span class="p">,</span><span class="nl">"tags"</span><span class="p">:</span><span class="w"> </span><span class="s2">"KB: SAP logon screen hangs - Oracle | "</span><span class="p">,</span><span class="nl">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://10.0.82.13/DOC-1007.html"</span><span class="p">},</span><span class="w">
</span><span class="p">]}</span><span class="err">;</span><span class="w">

</span></code></pre></div></div>

<p>The engine needs 3 attributes:</p>
<ul>
  <li>title: The title of the web site.</li>
  <li>text:Some of the content of the site.</li>
  <li>url: This is important, because on the search results, you will get a link with the url just to click on the results.</li>
</ul>

<p>I’m indexing some <a href="https://www.jivesoftware.com/">Jive documents</a>. So my script in python to generate the json looks like this:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">urllib2.request</span>
<span class="kn">import</span> <span class="nn">glob</span><span class="p">,</span> <span class="n">os</span>
<span class="kn">import</span> <span class="nn">codecs</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>


<span class="k">def</span> <span class="nf">paquillo</span><span class="p">():</span>


    <span class="n">max_lenth</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">tag_start</span> <span class="o">=</span> <span class="mi">11</span>

    <span class="n">output_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'D:\Documentos\index.json'</span><span class="p">,</span><span class="s">'w+'</span><span class="p">)</span>
    

    <span class="n">os</span><span class="p">.</span><span class="n">chdir</span><span class="p">(</span><span class="s">"D:\docs"</span><span class="p">)</span>
    <span class="k">for</span> <span class="nb">file</span> <span class="ow">in</span> <span class="n">glob</span><span class="p">.</span><span class="n">glob</span><span class="p">(</span><span class="s">"DOC-[0-9][0-9][0-9][0-9].html"</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'Document: '</span><span class="o">+</span><span class="nb">file</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">codecs</span><span class="p">.</span><span class="nb">open</span><span class="p">(</span><span class="nb">file</span><span class="p">,</span><span class="n">encoding</span><span class="o">=</span><span class="s">'utf-8'</span><span class="p">)</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">read</span><span class="p">())</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="s">'.jive-rendered-content'</span><span class="p">))</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">doc</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="s">'.jive-rendered-content'</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">text_lenth</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">.</span><span class="n">get_text</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">text_lenth</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="o">=</span><span class="n">max_lenth</span><span class="p">:</span>
                <span class="n">content_text</span> <span class="o">=</span>  <span class="n">text</span><span class="p">.</span><span class="n">get_text</span><span class="p">()[:</span><span class="n">max_lenth</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">text_lenth</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">content_text</span> <span class="o">=</span> <span class="n">doc</span><span class="p">.</span><span class="n">title</span><span class="p">.</span><span class="n">string</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="n">content_text</span> <span class="o">=</span> <span class="n">text</span><span class="p">.</span><span class="n">get_text</span><span class="p">()</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">content_text</span> <span class="o">=</span> <span class="n">doc</span><span class="p">.</span><span class="n">title</span><span class="p">.</span><span class="n">string</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="s">'.jive-icon-med .jive-icon-folder'</span><span class="p">))</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">tags</span> <span class="o">=</span> <span class="n">doc</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="s">'.jive-icon-med .jive-icon-folder'</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">tag_lenth</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tags</span><span class="p">.</span><span class="n">get_text</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">tag_lenth</span> <span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="n">tag_start</span><span class="p">:</span>
                <span class="n">tag_text</span> <span class="o">=</span> <span class="n">tags</span><span class="p">[:</span><span class="o">-</span><span class="n">tag_start</span><span class="p">]</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="n">tag_text</span> <span class="o">=</span> <span class="n">doc</span><span class="p">.</span><span class="n">title</span><span class="p">.</span><span class="n">string</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">tag_text</span> <span class="o">=</span> <span class="n">doc</span><span class="p">.</span><span class="n">title</span><span class="p">.</span><span class="n">string</span>

                    
                
        <span class="n">string_to_file</span> <span class="o">=</span>  <span class="p">(</span><span class="s">'{</span><span class="se">\"</span><span class="s">title</span><span class="se">\"</span><span class="s">: </span><span class="se">\"</span><span class="s">'</span><span class="o">+</span><span class="n">string</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="n">doc</span><span class="p">.</span><span class="n">title</span><span class="p">.</span><span class="n">string</span><span class="p">,</span><span class="s">'</span><span class="se">\"</span><span class="s">'</span><span class="p">,</span><span class="s">''</span><span class="p">).</span><span class="n">strip</span><span class="p">()</span><span class="o">+</span><span class="s">'</span><span class="se">\"</span><span class="s">, </span><span class="se">\"</span><span class="s">text</span><span class="se">\"</span><span class="s">: </span><span class="se">\"</span><span class="s">'</span><span class="o">+</span>
              <span class="n">string</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="n">content_text</span><span class="p">,</span><span class="s">'</span><span class="se">\"</span><span class="s">'</span><span class="p">,</span><span class="s">''</span><span class="p">).</span><span class="n">replace</span><span class="p">(</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">,</span><span class="s">''</span><span class="p">).</span><span class="n">strip</span><span class="p">()</span><span class="o">+</span><span class="s">'</span><span class="se">\"</span><span class="s">,'</span><span class="o">+</span>
              <span class="s">'</span><span class="se">\"</span><span class="s">tags</span><span class="se">\"</span><span class="s">: </span><span class="se">\"</span><span class="s">'</span><span class="o">+</span><span class="n">string</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tag_text</span><span class="p">,</span><span class="s">'</span><span class="se">\"</span><span class="s">'</span><span class="p">,</span><span class="s">''</span><span class="p">).</span><span class="n">strip</span><span class="p">()</span><span class="o">+</span><span class="s">'</span><span class="se">\"</span><span class="s">,'</span><span class="o">+</span>
              <span class="s">'</span><span class="se">\"</span><span class="s">url</span><span class="se">\"</span><span class="s">: </span><span class="se">\"</span><span class="s">'</span> <span class="o">+</span>  <span class="s">'http://10.0.82.13/'</span> <span class="o">+</span> <span class="nb">file</span> <span class="o">+</span><span class="s">'</span><span class="se">\"</span><span class="s">},'</span><span class="p">).</span><span class="n">encode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">)</span><span class="o">+</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span>           
        <span class="n">output_file</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">string_to_file</span><span class="p">)</span>

    <span class="n">output_file</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="mi">0</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
   <span class="c1"># sys.setdefaultencoding('utf-8')
</span>    <span class="c1">#reload(sys)
</span>    <span class="n">paquillo</span><span class="p">()</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>

</code></pre></div></div>


  </div><a class="u-url" href="/2015/06/15/indexing-a-website-using-javascript-search-engine" hidden></a>
</article>
